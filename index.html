<!DOCTYPE html>
<html>
<head>
  <title>Hi Judy!</title>
  <link rel="shortcut icon" href="favicon2.ico" />
</head>
<body>

<h1>Hi Judy!</h1>
<div class="d-flex flex-row">
  <div class="d-flex flex-col">
    <h3>Names</h3>
    <textarea
      class="names"
      id="names">
Johnny
Felix
Michelle
Kendra
Web
Roger
Rene
Andria
Rona
Dylan
Judy
Pat
KJ
Luga
Albert
Stefan
Clive
Silvia
Water
Patty
Lay
Hsiu
Tony
Fabien
Soufiane
Carolina
Ray 
Zac
Emily
Max
JasonZ
Mike
Weiwei
Peter
April
Eason
Kay
Allan
Gary</textarea>
    <input
      class="button"
      type="button"
      value="Get Evaluated List"
      onclick="getEvaluatedList()">
    
  </div>
  <div class="d-flex flex-col ml-20">
    <h3>Counterparts</h3>
    <textarea
      class="counterparts"
      id="counterparts">
Ray	Rene	Michelle	KJ	Silvia
Hsiu	Web	KJ	Rene	Johnny
Luga	Web	Dylan	Pat	Rene	KJ	Peter	Allan	Eason	Silvia
Eason	Luga	Dylan	Pat	Peter					
Rona	Pat	Zac	Dylan	Michelle			
Michelle	Rene	Johnny	Rona	Ray	Emily	Albert	WeiWei
Allan	Web	Dylan	Pat	Rene	KJ	Peter	Luga		
Clive	Tony	Roger	Peter	Lay	Kay	JasonZ	Mike		
JasonZ	Peter	Lay	Kay	Clive					
Lay	Peter	JasonZ	Kay	Clive					
Roger	Clive	Mike							
Kay	Peter	JasonZ 	Lay	Clive					
Peter	Luga	Clive	JasonZ	Lay 	Kay	Allan	Eason	Silvia	Web
Water	Mike	Tony	Max							
Mike	Roger	Clive	Tony	Water						
Tony	Web	Dylan	Water	Silvia	Clive	Kendra	Max	Stefan	Mike	WeiWei
Kendra	Web 	Tony	WeiWei							
Max	Water	Tony								
WeiWei	Kendra	Tony	Michelle	KJ	Web					
April	Rene	Andria	Stefan
Stefan	Andria	Tony	April
Andria	Stefan	April	
Pat	Luga	Rene	KJ	Rona	Allan	Eason	
Dylan	Web 	Tony	Luga	Rona	KJ	Allan	Eason
Albert	KJ	Michelle					
Fabien	Carolina	Silvia	Rene	KJ	Soufiane						
Silvia	Fabien 	Peter	Rene	Emily	Patty	KJ	Soufiane	Carolina	Ray	Tony	Luga
Soufiane	Fabien 	Carolina	Silvia								
Carolina	Fabien 	Soufiane	Silvia								
Gary	Web
KJ	Rene 	Web	Pat	Fabien	Luga	Dylan	Albert	Hsiu	Silvia	Emily	Ray	Judy	WeiWei	Allan
Judy	Rene 	Web	Zac	KJ										
Zac	Rona	Judy	Rene											
Web	Peter	Allan	Luga	Rene	KJ	Kendra	Tony	Hsiu	Judy	Dylan	Gary	WeiWei		
Emily	Rene 	Johnny	KJ	Silvia	Michelle									
Patty	Silvia</textarea>
    <input
      class="button"
      type="button"
      value="Check Bidirection"
      onclick="checkBidirection()">
  </div>
  <div class="d-flex flex-col ml-60">
    <h3>BU and Function</h3>
    <textarea
      class="bu-function"
      id="bu-function">
BU Dev
RD	Roger

BU Real estate
Head	Phoebe

BU Showroom
PM	Michelle
RD	Jason

BU XR
Head	Hsiu

BU VEx
Pre sales	Wenn

BU CS
Head	Rona

BU 2D Maker
Head	Luga
RD	Clive
RD	JasonZ

BU 3D Maker
Head	Joy
RD	Water
RD	Lay 
PM	Tony
PM	Kendra
RD	Max

BU Online
Sales	Stefan
Affliate manager	Andria

BU TW sales
Sales	Pat
Sales	Dylan
Sales	Albert
Sales	Ray

BU EMEA
Head	Fabien
PJM / HQC	Silvia
BD	Soufiane
AM	Carolina

BU Admin
Auditor	KJ
HR	Judy
Receptionist	Zac
RD mgmt	Web
Finance	Emily

BU Oversea sales
Sales	Patty</textarea>
  </div>
  <div class="d-flex flex-col ml-20">
    <h3>Query</h3>
    <textarea
      class="query"
      id="query"
      oninput="queryBUAndFunction()">Web</textarea>
    <h3>Output</h3>
    <textarea
      class="output"
      id="output">
Admin
Web
RD mgmt</textarea>
  </div>
  <div class="d-flex flex-col ml-60">
    <h3>Names to be shuffled</h3>
    <textarea
      class="query2"
      id="query2"
      oninput="shuffleNames()">Action	Cloud	Roxy</textarea>
    <h3>Output</h3>
    <textarea
      class="output2"
      id="output2">Cloud	Roxy	Action</textarea>
  </div>
</div>
<div
  class="d-flex flex-col"
  style="display: none;"
  id="results-div">
  <h3>Results</h3>
  <textarea
    class="results"
    id="results">
  </textarea>
</div>

<script>
  let _buAndFunction = '';
  let buAndFunctionList = [];

  const getEvaluatedList = () => {
    const names = document.getElementById('names').value;
    const counterparts = document.getElementById('counterparts').value;
    const nameList = [];
    const evaluated = {};
    names.split('\n').forEach(name => {
      if (name.trim()) {
        nameList.push(name.trim());
        evaluated[name.trim().toLowerCase()] = [];
      }
    });
    counterparts.split('\n').forEach(line => {
      const s = line.trim().split('\t');
      for (let i = 1; i < s.length; i++) {
        if (evaluated[s[i].trim().toLowerCase()]) {
          evaluated[s[i].trim().toLowerCase()].push(s[0].trim());
        } else if (s[i].trim()) {
          console.log(`"${s[i].trim()}" is a bad name`);
        }
      }
    });
    let results = '';
    nameList.forEach(name => {
      results += name + '\t';
      evaluated[name.toLowerCase()].sort((a, b) => a > b ? 1 : -1);
      evaluated[name.toLowerCase()].forEach(e => {
        results += e + '\t';
      })
      results += '\n';
    });
    document.getElementById('results').value = results;
    document.getElementById('results-div').style.display = '';
    console.log('getEvaluatedList done');
  };

  const checkBidirection = () => {
    const bosses = ['johnny', 'rene', 'felix'];
    const names = document.getElementById('names').value;
    const counterparts = document.getElementById('counterparts').value;
    const nameList = [];
    const nameListBuOrder = [];
    const nameListBuOrderLower = [];
    const evaluated = {};
    names.split('\n').forEach(name => {
      if (name.trim()) {
        nameList.push(name.trim());
        evaluated[name.trim().toLowerCase()] = [];
      }
    });
    counterparts.split('\n').forEach(line => {
      const s = line.trim().split('\t');
      if (s.length < 2) {
        return;
      }
      nameListBuOrder.push(s[0].trim());
      nameListBuOrderLower.push(s[0].trim().toLowerCase());
      for (let i = 1; i < s.length; i++) {
        if (evaluated[s[i].trim().toLowerCase()]) {
          evaluated[s[i].trim().toLowerCase()].push(s[0].trim());
        } else if (s[i].trim() && !bosses.includes(s[i].trim().toLowerCase())) {
          console.log(`"${s[i].trim()}" not found`);
        }
      }
    });
    let results = '';
    nameList.forEach(name => {
      if (bosses.includes(name.toLowerCase())) {
        return;
      }
      if (!nameListBuOrderLower.includes(name.toLowerCase())) {
        console.log(`"${name}" not in BU list`);
      }
    })
    nameListBuOrder.forEach(name => {
      if (bosses.includes(name.toLowerCase())) {
        return;
      }
      evaluated[name.toLowerCase()].sort((a, b) => a > b ? 1 : -1);
      evaluated[name.toLowerCase()].forEach(name2 => {
        let exists = false;
        if (evaluated[name2.trim().toLowerCase()]) {
          evaluated[name2.trim().toLowerCase()].forEach(name3 => {
            if (name3.trim().toLowerCase() === name.toLowerCase()) {
              exists = true;
            }
          })
        } else {
          console.log(`"${name2.trim()}" not found`);
        }
        if (!exists) {
          results += `${name} should be evaluated by ${name2}\n`;
        }
      });
    });
    document.getElementById('results').value = results;
    document.getElementById('results-div').style.display = '';
    console.log('checkBidirection done');
  };

  const queryBUAndFunction = () => {
    const buAndFunction = document.getElementById('bu-function').value;
    if (buAndFunction !== _buAndFunction) {
      _buAndFunction = buAndFunction;
      buAndFunctionList = [];
      let bu = '';
      buAndFunction.split('\n').forEach(s => {
        if (s.startsWith('BU')) {
          bu = s.trim().slice(3);
        } else {
          const func = s.split('\t')[0].trim();
          const name = s.split('\t')[1];
          if (name) {
            buAndFunctionList.push({
              name: name.trim().toLowerCase(),
              str: `${bu}\n${name.trim()}\n${func}`
            });
          }
        }
      });
      buAndFunctionList.sort((a, b) => a.name > b.name ? 1 : -1);
    }
    let output = '?';
    const query = document.getElementById('query').value.trim().toLowerCase();
    if (!query) {
      document.getElementById('output').value = output;
      return;
    }
    for (let i = 0; i < buAndFunctionList.length; i++) {
      if (buAndFunctionList[i].name.startsWith(query)) {
        output = buAndFunctionList[i].str;
        break;
      }
    }
    document.getElementById('output').value = output;
  };

  const shuffleNames = () => {
    const names = document.getElementById('query2').value;
    const splitedNames = names.trim().split('\t');
    let output = '';
    if (splitedNames.length > 1) {
      splitedNames.sort(() => Math.random() - 0.5);
      for (let i = 0; i < splitedNames.length; i++) {
        output += splitedNames[i].trim();
        if (i < splitedNames.length - 1) {
          output += '\t';
        }
      }
    }
    document.getElementById('output2').value = output;
  };
</script>
<style>
h1 {
  margin: 0;
}
.d-flex {
  display: flex;
}
.flex-row {
  flex-direction: row;
}
.flex-col {
  flex-direction: column;
}
.ml-20 {
  margin-left: 20px;
}
.ml-60 {
  margin-left: 60px;
}
textarea {
  overflow: scroll;
  white-space: nowrap;
  resize: none;
}
.names {
  width: 124px;
  height: 260px;
}
.counterparts {
  width: 420px;
  height: 260px;
}
.results {
  width: 570px;
  height: 260px;
}
.bu-function {
  width: 260px;
  height: 260px;
}
.query {
  width: 160px;
  height: 32px;
}
.output {
  width: 160px;
  height: 158px;
}
.query2 {
  width: 320px;
  height: 32px;
}
.output2 {
  width: 320px;
  height: 32px;
}
.button {
  width: 130px;
  margin-top: 20px;
}
</style>

</body>
</html>
